C51 COMPILER V9.57.0.0   JIAOTONGDENG                                                      06/22/2021 18:44:50 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE JIAOTONGDENG
OBJECT MODULE PLACED IN jiaotongdeng.OBJ
COMPILER INVOKED BY: E:\mdkArmkeil5\C51\BIN\C51.EXE jiaotongdeng.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg51.h>
   2          
   3          #define uchar unsigned char
   4          #define uint unsigned int
   5          
   6          sbit dula=P2^6;
   7          sbit wela=P2^7;
   8          sbit beep=P2^3;
   9          //23
  10          sbit MOTOR1=P1^0;
  11          sbit MOTOR2=P1^1;
  12          
  13          sbit key_green = P3^6;
  14          sbit key_yellow = P3^7;
  15          
  16          bit alwaysyellow=0;
  17          
  18          unsigned int ppp;
  19          unsigned char code table[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,
  20                                  0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  21          uchar jj,kk,l=255;
  22          uchar aa1,aa0;
  23          uchar shijian,deng=1;
  24          void delay(unsigned int i)
  25          {
  26   1        for(jj=i;jj>0;jj--)
  27   1          for(kk=125;kk>0;kk--);
  28   1      }
  29          
  30          void display(unsigned char sh_c,unsigned char g_c)
  31          {
  32   1         dula=0;
  33   1         P0=table[sh_c];
  34   1         dula=1;
  35   1         dula=0;
  36   1         
  37   1         wela=0;
  38   1         P0=0xfe;
  39   1         wela=1;
  40   1         wela=0;
  41   1         delay(5);
  42   1         
  43   1         P0=table[g_c];
  44   1         dula=1;
  45   1         dula=0;
  46   1         
  47   1         P0=0xfd;
  48   1         wela=1;
  49   1         wela=0;
  50   1         delay(5);
  51   1      }
  52          
  53          void main()
  54          {
  55   1        TMOD=0x01;
C51 COMPILER V9.57.0.0   JIAOTONGDENG                                                      06/22/2021 18:44:50 PAGE 2   

  56   1        TR0=1;
  57   1        TH0=(65536-46080)/256; 
  58   1        TL0=(65536-46080)%256;//50000*11.0592/12
  59   1        ET0=1;
  60   1      
  61   1      //  IT1=1;//
  62   1      //  EX1=1;//  
  63   1      //  IT0=1;//
  64   1      //  EX0=1;//
  65   1        
  66   1        EA=1;
  67   1        while(1)
  68   1        { 
  69   2          //green switchs
  70   2          if(key_green == 0)
  71   2          {
  72   3            delay(100);
  73   3            shijian = 0;
  74   3            deng = 1;
  75   3          while(!key_green);
  76   3          }
  77   2          
  78   2          if(key_yellow == 0)
  79   2          {
  80   3          delay(100);
  81   3          shijian = 0;
  82   3          deng = 2;
  83   3          while(!key_yellow);
  84   3          alwaysyellow = !alwaysyellow;
  85   3          }
  86   2          
  87   2          if(shijian==0 && !alwaysyellow)
  88   2          {
  89   3            deng++;
  90   3            deng%=3;
  91   3            switch(deng)
  92   3            {
  93   4              case 0: shijian=5;      //ºìµÆ
  94   4                  deng=0;
  95   4                  break;
  96   4              case 1: shijian=5;      //ÂÌµÆ
  97   4                  deng=1;
  98   4                  break;
  99   4              case 2: shijian=5;      //»ÆµÆ
 100   4                  deng=2;
 101   4                  break;
 102   4      //        case 3: shijian=5;      //»ÆµÆ
 103   4      //            deng=0;
 104   4      //            break;
 105   4              }
 106   3          }
 107   2          if(ppp==20)
 108   2          { 
 109   3            ppp=0;
 110   3            shijian--;
 111   3          }
 112   2          aa0=shijian%10;
 113   2          aa1=shijian/10;
 114   2          
 115   2          if(!alwaysyellow)
 116   2          display(aa1,aa0);
 117   2          
C51 COMPILER V9.57.0.0   JIAOTONGDENG                                                      06/22/2021 18:44:50 PAGE 3   

 118   2          
 119   2          switch(deng)
 120   2          {
 121   3            case 0: P1=0X00;       //ºìµÆ
 122   3                MOTOR2=0;
 123   3                MOTOR1=0;
 124   3                break;
 125   3      //      case 3:       //»ÆµÆ
 126   3      //          if(shijian%2==0)
 127   3      //            {
 128   3      //              P1=0x00;
 129   3      //              beep=1;
 130   3      //            }
 131   3      //          if(shijian%2==1)
 132   3      //            {
 133   3      //               P1=0xff;
 134   3      //               beep=0;
 135   3      //            }
 136   3      //          break;
 137   3            case 1:     //ÂÌµÆ
 138   3                    MOTOR1=1;
 139   3                    MOTOR2=0;
 140   3                break;
 141   3            case 2:  //yellow
 142   3                if(shijian%2==0)
 143   3                  {
 144   4                    P1=0x00;
 145   4                    beep=1;
 146   4                  }
 147   3                if(shijian%2==1)
 148   3                  {
 149   4                     P1=0xff;
 150   4                     beep=0;
 151   4                  }
 152   3                break;  
 153   3          }
 154   2        }
 155   1      }
 156          
 157          void time0() interrupt 1
 158          {
 159   1        TH0=(65536-46080)/256;
 160   1        TL0=(65536-46080)%256;
 161   1        ppp++;
 162   1      }
 163          //void green() interrupt 0
 164          //{
 165          //  delay(100);
 166          //  led_green = ~led_green;
 167          //  if(key_green == 0){
 168          //    shijian = 0;
 169          //    deng = 1;
 170          //    while(!key_green);
 171          //  }
 172          //}
 173          
 174          //void yellow() interrupt 2
 175          //{
 176          //  
 177          //  delay(100);
 178          //  if(key_yellow == 0){
 179          //    shijian = 0;
C51 COMPILER V9.57.0.0   JIAOTONGDENG                                                      06/22/2021 18:44:50 PAGE 4   

 180          //    deng = 2;
 181          //    while(!key_yellow);
 182          //    delay(200);
 183          //  }
 184          //  while(!key_yellow);//night mode, always yellow unless retouch the key_yellow button;
 185          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    293    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
